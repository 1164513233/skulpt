<html>
<!--
Example of using the turtle module in skulpt.
Author:  Brad Miller

Note:  One important convention, since I plan to use
multiple turtle canvases on a page I am passing the runit
function a prefix to use in creating the id for the following:
  - textarea containing the code
  - pre tag for any printed output
  - canvas tag for the turtle
I've enclosed the whole group of them in a div because I was thinking
at one point about creating the pre tag and the canvas tag on the fly
the more I think about it the more I wonder...
-->
<head>
<title>Processing Integration with Skulpt</title>
<script src="skulpt.js" type="text/javascript"></script>
<script src="builtin.js" type="text/javascript"></script>
<script src="processing-1.4.1.min.js" type="text/javascript"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript" >
</script>

</head>

<body>
<script type="text/javascript">
function outf(text) {
   var mypre = document.getElementById(Sk.pre);
   mypre.innerHTML = mypre.innerHTML + text;
}

function builtinRead(x)
{
    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
        throw "File not found: '" + x + "'";
    return Sk.builtinFiles["files"][x];
}

function runit(myDiv) {
   var prog = document.getElementById(myDiv+"_code").value;
   var mypre = document.getElementById(myDiv+"_pre");
   mypre.innerHTML = '';
   Sk.canvas = myDiv+"_canvas";
    var can = document.getElementById(Sk.canvas);
    can.style.display = 'block';
    if (can) {
        can.width = can.width;
        if (Sk.tg) {
            Sk.tg.canvasInit = false;
            Sk.tg.turtleList = [];
        }
    }

   Sk.pre = myDiv+"_pre";
   Sk.configure({output:outf,
  	        read: builtinRead
              });
   try {
      Sk.importMainWithBody("<stdin>",false,prog);
   } catch (e) {
      alert(e);
   }
}
</script>
<h1>Integrating Processing-js and Skulpt!</h1>
<h1>Recursive Circles</h1>
<p>This illustrates how processing and skulpt work together.  You must define a draw function that does the drawing, and then you must call the run function to start things off.  You may optionally define a setup call that does one time initialization of size and color etc.</p>

<div id="example2">
<textarea edit_id="eta_5a" id="example2_code" cols="60" rows="10">
from processing import *

def setup():
    size(400,400)
    noStroke()
    smooth()
    noLoop()

def draw():
    drawCircle(200,170,6)

def drawCircle(x, radius, level):
    tt = 128.0 * level / 4.0
    fill(tt)
    ellipse(x, 200, radius*2, radius*2)
    if level > 1:
        level = level - 1
        drawCircle(x - radius / 2, radius/2, level)
        drawCircle(x + radius / 2, radius/2, level)

run()
</textarea>
<button onclick="runit('example2')" type="button">Run</button>
<canvas id="example2_canvas"></canvas>
<pre id="example2_pre"></pre>

</div>

<h3>Try These</h3>
<p>There are three functions defined in this example, each returns a draw function.
<ul>
<li>ellipseFun()</li>
<li>colorFun</li>
<li>distanceFun</li>
</ul>
Click the run button and then move your mouse over the picture.  To try one of the other examples change the second to the last line to make draw refer to a different function.
</p>
<div id="example1">
<form>
<textarea edit_id="eta_5" id="example1_code" cols="60" rows="10">
from math import sin, sqrt
from processing import *


X = 30
Y = 30
nX = X
nY = Y
delay = 16
radius = 30
fc = 1

def setup():
   strokeWeight(10)
   frameRate(20)
   size(300,300)

def ellipseFun():
    def draw():
       global X, Y, delay, radius, fc
       background(100)
       fill(0,121,184)
       stroke(255)
       X += (nX-X)/delay;
       Y += (nY-Y)/delay;

       radius = radius + sin(fc / 4)
       fc += 1
       ellipse(X,Y,radius,radius)
    return draw

def colorFun():
    def draw():
        noStroke()
        noLoop()
        colorMode(RGB,300)
        for r in range(300):
            for g in range(300):
                stroke(r, g, 0)
                point(r,g)
    return draw

def dist(x1,y1,x2,y2):
    o = y2-y1
    a = x2-x1
    return sqrt(o*o + a*a)

def distanceFun():
    def draw():
        background(51)
        strokeWeight(1)
        for i in range(0,environment.width,20):
            for j in range(0,environment.width,20):
               size = dist(mouse.x,mouse.y,i,j)
               size = size/dist(0,0,environment.height,environment.width) * 100
               ellipse(i,j,size,size)
    return draw


def mouseMoved():
    global nX, nY
    nX = mouse.x
    nY = mouse.y

draw = distanceFun()

run()
</textarea>
<button onclick="runit('example1')" type="button">Run</button>
</form>

<canvas id="example1_canvas" height="500" width="800"
  style="border-style: solid; display: none"></canvas>
<pre id="example1_pre"></pre>

</div>


</body>
</html>
